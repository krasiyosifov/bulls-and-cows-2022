<!DOCTYPE html>

<html>

<head>
    <link rel="stylesheet" href="index.css">
    <title>Bulls and Cows game</title>
    <link rel="stylesheet" href="index.css" />
</head>

<body>
    <script>
        function myFunction() {
            var numberValue = document.getElementById("my_number").value;
            console.log(numberValue);
            if (isNumberValid(numberValue)) {
                console.log("the number is valid");
                // TODO: put the result in the validation_result container
            } else {
                console.log("the number is invalid");
                // TODO: put the result in the validation_result container
            }
        }

        function isNumberValid(numberAsString) {
            var digits = numberAsString.split("");
            console.log(digits);
            if (digits.length != 4) {
                return false;
            }
            for (let i = 0; i <= 2; i++) {
                let d1 = digits[i];
                for (let j = i + 1; j <= 3; j++) {
                    let d2 = digits[j];
                    if (d1 == d2) {
                        return false;
                    }
                }
            }
            return true;
        }

        function calculateBullsAndCows(a, b) {
            let result = {
                bulls: 0,
                cows: 0
            };
            let aDigits = a.split("");
            let bDigits = b.split("");

            console.log(aDigits);
            console.log(bDigits);
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    if (aDigits[i] == bDigits[j]) {
                        if (i == j) {
                            result.bulls++;
                        }
                        else {
                            result.cows++;
                        }
                        break;
                    }
                }
            }

            return result;
        }

        console.log(calculateBullsAndCows('1567', '1763'));

        let lastShownContainer = "home_scene_container";
        function showContainer(containerId) {
            if (lastShownContainer != "") {
                document.getElementById(lastShownContainer).classList.add("off");
            }
            document.getElementById(containerId).classList.remove("off");
            lastShownContainer = containerId;
        }

        function handleNewGameButton() {
            preparePlayerDetailsUI(0);
            showContainer('player_details_scene_container');
            focusName();
        }

        function preparePlayerDetailsUI(playerIndex) {
            document.getElementById("player_details_name_error").classList.add("off");
            document.getElementById("number_container").classList.add("off");
            document.getElementById("player_name").value = "";
            document.getElementById("player_number").value = "";

        }


        function focusName() {
            document.getElementById("player_name").focus();
        }
        function focusNumber() {
            document.getElementById("player_number").focus();
        }
        /**
         * Name validation and storing
         * 
         */
        var playerNames = [
            'player1',
            'player2'
        ];
        var currentPlayerIndex = 0;
        function checkNameAndContinue() {
            // get player name from form field
            var playerName = document.getElementById("player_name").value;
            // check for valid value
            if (playerName != "") {
                // name is valid
                // save player name into playerNames
                playerNames[currentPlayerIndex] = playerName;
                // update player name text in label
                document.getElementById("player_details_name").innerHTML = playerName;
                // show number container 
                document.getElementById("number_container").classList.remove("off");
            }
            else {
                // name is invalid
                document.getElementById("player_details_name_error").classList.remove("off");
                document.getElementById("player_name").focus();

            }
            focusNumber();

        }

        var playerNumbers = [
            '',
            ''
        ]
        function checkNumberAndContinue() {
            //read the number from the form field
            var numberValue = document.getElementById("player_number").value;
            console.log(numberValue);

            //check if the number is valid
            if (isNumberValid(numberValue) == true) {
                // save player number into playerNumbers
                playerNumbers[currentPlayerIndex] = numberValue;

                if (currentPlayerIndex == 0) {
                    // next player's turn
                    currentPlayerIndex = 1;
                    // prepare UI
                    preparePlayerDetailsUI(currentPlayerIndex);
                }
                else {
                    showContainer('main_game_screen_container');
                    prepareMainPlayerGuessesUI(0);
                }

                // //if valid goes to the next person or main game scene
                //
            }
            else {
                //if invalid shows error
                document.getElementById("player_details_number_error").classList.remove("off");
            }
            focusName();
        }

    </script>

    <div id="home_scene_container" class="scene_container">


        <div id="home_scene_container" class="scene_container">

            <div class="bullsandcows">
                <h2>Bulls
                    <div class="homePageImages">

                        <img class="bullImgRotate" src="images/bullHomeScreen.png" width="170" height="170">
                        &
                        <img class="cowImgRotate" src="images/cowHomeScreen.png" width="150" height="150">

                    </div>
                    Cows
                </h2>
            </div>
            <div class="buttons">
                <button class="buttonPlay" onclick="handleNewGameButton()">New Game</button>
                <button id="how_to_play" class="buttonPlay" onclick="openModal()">How to play</button>
            </div>
        </div>
    </div>



    <div id="player_details_scene_container" class="scene_container off">
        <!-- here goes the HTML code -->
        <div class="mainContainer">
            <div class="playerDetails">
                <form class="playerDetailsScene">
                    <div class="detailsPlayer">
                        <label for="name"><b>Enter nickname:</b></label>
                        <div class="playerInput">
                            <input class="inputPlayerName" type="text" id="player_name">
                            <button class="confirmButton" type="button" onclick="checkNameAndContinue()">✓</button>
                        </div>
                        <p class="errorLabel off" id="player_details_name_error">Please enter your nickname</p>
                    </div>
                    <div class="detailsPlayer off" id="number_container">
                        <label for="number"> <span id="player_details_name">Vicky</span> enter number:</label>
                        <div class="playerInput">
                            <input class="inputPlayerNumber" type="text" id="player_number" minlength="4" maxlength="4">
                            <button class="confirmButton" type="button" onclick="checkNumberAndContinue()">✓</button>
                        </div>
                        <p class="errorLabel off" id="player_details_number_error">Invalid number! Try again!</p>
                    </div>

                </form>
            </div>
            <button class="howToPlay" onclick="openModal()"><b>?</b></button>

        </div>
    </div>

    <div id="winning_page_scene_container" class="scene_container off">
        <!-- here goes the HTML code -->
        <div class="endGame">
            <form>
                <div class="winningLabels">
                    <label for="theWinnerIs"><b>THE WINNER IS:</b></label><br>
                    <label for="winner"><b>...</b></label>
                </div>
                <div class="buttonOptions">
                    <button type="button" id="revengeButton"
                        onclick="showContainer('player_details_scene_container')">REVENGE</button>
                    <button type="button" id="newGameButton"
                        onclick="showContainer('player_details_scene_container')">NEW GAME</button>
                    <button type="button" id="exitButton" onclick="showContainer('home_scene_container')">EXIT</button>
                </div>
            </form>
        </div>
    </div>

    <div id="how_to_play_scene_container" class="scene_container howToPlayModal ">
        <!-- here goes the HTML code -->
        <script>
            var modalHowToPlay = document.getElementById("how_to_play_scene_container");
            var btn = document.getElementById("how_to_play");

            function openModal() {
                modalHowToPlay.style.display = "block";
                console.log(modalHowToPlay);
            }
            if (modalHowToPlay) {
                window.onclick = function (event) {
                    if (event.target == modalHowToPlay) {
                        modalHowToPlay.style.display = "none";
                    }
                }
            }
            function closeModal() {
                modalHowToPlay.style.display = "none";
            }
        </script>
        <div class="modalContent">
            <h1>How to play?</h1>
            <button class="closeButton" type="button" onclick="closeModal()">X</button>
            <p>The game can be played by 2 people.</p>
            <p>First, Player1 enters their name and clicks the check button when they are done. After that a new text
                field
                appears where the player should input their chosen number, which should be kept secret from the other
                player.
                The digits must be all different. The number cannot start with 0. The number must have 4 digits. Same
                thing
                happens for Player2. </p>
            <p>Then, in turn, the players try to guess their opponent's number by inputting it in the four digit text
                field.
                The
                digits of the guessing number also must all be different. If the matching digits exist and are in their
                right
                positions, they are "bulls", if not, they are "cows". </p>
            <p>Example:</p>
            <ul>
                <li>P1’s number: 4271</li>
                <li>P2’s guessing number: 1234</li>
                <li>Answer: 1 bull and 2 cows. (The bull is "2", the cows are "4" and "1".)</li>
            </ul>
            <p>After the first round a list, which contains the already used guessing numbers, will appear in top left
                corner.
                On the right the player can look at the numbers from 1 to 9 and check which one is not needed anymore.
            </p>
            <p>In the top right corner there is a question button. If you need to check the rules of the game again you
                can
                press it.</p>
            <p>If both players win they can press the revenge button and play again.</p>

        </div>
    </div>
    </div>


    <div id="main_game_screen_container" class="scene_container off">

        <!-- here goes the HTML code -->
        <script>
            var mainPlayerGuesses = [
                '',
                ''
            ]
            function prepareMainPlayerGuessesUI(playerIndex) {
                document.getElementById("main_player_details_number_error").classList.add("off");
                document.getElementById("player_guess_number").value = "";
                document.getElementById("player_span").innerHTML = playerNames[playerIndex];
            }

            function checkGuessesAndContinue() {
                //read the number from the form field
                var numberValue = document.getElementById("player_guess_number").value;
                console.log(numberValue);
                console.log(currentPlayerIndex);
                document.getElementById("continue_button").classList.remove("off");
                //check if the number is valid
                if (isNumberValid(numberValue) == true) {
                    // save player number into playerNumbers
                    mainPlayerGuesses[currentPlayerIndex] = numberValue;

                    if (currentPlayerIndex == 0) {
                        // next player's turn
                        currentPlayerIndex = 1;
                        // prepare UI
                        prepareMainPlayerGuessesUI(currentPlayerIndex);
                    } else {
                        currentPlayerIndex = 0;
                        prepareMainPlayerGuessesUI(currentPlayerIndex);

                    }

                    // //if valid goes to the next person or main game scene
                    //
                }
                else {
                    //if invalid shows error
                    document.getElementById("player_details_number_error").classList.remove("off");
                }
                focusName();
            }

            function inputPlayerGuess() {
                var numberValue = document.getElementById("player_guess_number").value;

                console.log(mainPlayerGuesses);
                console.log(numberValue);
                if (isNumberValid(numberValue)) {
                    document.getElementById("main_player_details_number_error").classList.add("off");
                    document.getElementById("continue_button").classList.remove("off");
                    calculateBullsAndCows(playerNumbers[currentPlayerIndex], numberValue);
                    console.log("the number is valid");
                    onInputEntered(numberValue)
                    // TODO: put the result in the validation_result container
                } else {
                    document.getElementById("continue_button").classList.add("off");
                    console.log("the number is invalid");
                    let errorLabel = document.getElementById("main_player_details_number_error");
                    errorLabel.classList.remove("off");
                    // TODO: put the result in the validation_result container
                }
            }

            var historyNumbersPlayer = [
                [],
                []
            ];

            function onInputEntered(numberValue) {
                historyNumbersPlayer[currentPlayerIndex].push(numberValue);
                historyNumbersList();
            }

            function historyNumbersList() {
                var historyElement = document.getElementById("history_numbers");
                historyElement.innerHTML = "";
                createHistoryElements(historyNumbersPlayer[currentPlayerIndex], historyElement)
            }

            function createHistoryElements(playerArray, historyElement) {
                playerArray.forEach(element => {
                    var historySpan = document.createElement("span");
                    historySpan.innerHTML = element;
                    historyElement.appendChild(historySpan);
                    console.log(historySpan);
                })
            }
        </script>

        <div class="mainContainer">
            <div id="history_numbers" style="display: flex;
            flex-direction: column;
            width: fit-content;
            position: absolute;
            left: 10px;
            padding: 5px;
            background: white;
            top:10px;">
            </div>
            <div class="btn-group">
                <button class="numberButton" type="button">0</button>
                <button class="numberButton" type="button">1</button>
                <button class="numberButton" type="button">2</button>
                <button class="numberButton" type="button">3</button>
                <button class="numberButton" type="button">4</button>
                <button class="numberButton" type="button">5</button>
                <button class="numberButton" type="button">6</button>
                <button class="numberButton" type="button">7</button>
                <button class="numberButton" type="button">8</button>
                <button class="numberButton" type="button">9</button>
            </div>

            <button class="howToPlay" type="button" onclick="openModal()">?</button>

            <div class="gameContainer">
                <div></div>
                <div class="sketchy">

                    <div class="playerTurn">
                        <label for="name">
                            <b>
                                <span id="player_span">Player1</span>'s turn:
                                <div>
                                    <input class="inputPlayerNumber" type="text" id="player_guess_number">
                                    <button class="confirmButton" type="button" onclick="inputPlayerGuess()">✓
                                    </button>
                                </div>
                            </b>
                        </label>
                        <p class="errorLabel off" id="main_player_details_number_error">Invalid number! Try again!
                            </br>
                            <a href="#" onclick="openModal()">How To Play?</a>
                        </p>
                    </div>
                    <div>
                        <label class="bullNumber" for="bull">4x</label>
                        <img src="images/bullCounter.png" style="width:100px;height:100px;">
                        <label class="cowNumber" for="cow">0x</label>
                        <img src="images/cowCounter.png" style="width:100px;height:100px;">
                    </div>
                </div>
                <div>
                    <button class="continueButton off" id="continue_button" type="button"
                        onclick="checkGuessesAndContinue()">CONTINUE
                    </button>
                </div>

            </div>
        </div>


</body>

</html>